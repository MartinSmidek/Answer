# (c) 2009, Martin Šmídek

//module UCETNICTVI [0,0,30,12] { active:Denik, units:'px'
//  var D_info: text,
//  var D_cond: text,
//  var D_suma: text, var D_cond2: text,
  #                                                                                                 DENÍK
panel Denik [,,,543] { title:'Deník a rozbory', //type:'panel'
  var rok: text,
  menu m {type:'left'
    menu stav {title:'účetní deník',type:'group'
      item a {title:'rok 2008', proc onclick () { rok.set(2008) } }
      item a {title:'rok 2009', proc onclick () { rok.set(2009) } }
    }
    proc onclick() { echo(rok) }
  }
  use u: form f [0,0,,]
}
/*
    use D_touch: group _touch [12,4,,],
    proc onstart () { D_touch.group_add; D_cond2.set(''); stop}
    proc onclick () { D_touch.volby.menu_fill2('ucet_menu','','',''); stop}
    proc D_menu (s,c) { D_show.panel_hide; D_show_load.panel_hide; D_show_surv.panel_hide;
      eq(s,'u-show');
      D_info.set(ask('ucet_todo','',s,c));
      D_touch.result.set(conc("<div id='info' class='info'>",D_info.get('html'),"</div>"));
      D_cond.set(D_info.get('cond'));
      D_show.popup(236,80)
    | eq(s,'u-load');
      D_info.set(ask('ucet_todo','',s,c));
      D_touch.result.set(conc("<div id='info' class='info'>",D_info.get('html'),"</div>"));
      D_cond.set(D_info.get('cond'));
      D_show_load.popup(236,80)
    | eq(s,'u-surv','u-akce','msds');
      D_info.set(ask('ucet_todo','',s,c));
      D_touch.result.set(conc("<div id='info' class='info'>",D_info.get('html'),"</div>"));
      D_cond.set(D_info.get('cond'));
#       D_show_surv.popup(236,80)
      stop
    }
  }
  # popups
  panel D_show [0,0,645,620] { //type:'subpanel'
    var obrat: text,
    use d: form _denik [0,0,,],
    proc onstart () { stop }
    proc onfocus () { D_zmena_check; stop }
    proc D_zmena_check () {
      D_cond2.set("0");
      D_cond2.set(conc(D_cond2.get,cconc(d.u5.get," OR left(md,1)=5")));
      D_cond2.set(conc(D_cond2.get,cconc(d.u6.get," OR left(dal,1)=6")));
      D_cond2.set(conc(D_cond2.get,cconc(d.u2.get," OR (left(md,1)=2 AND dal!=961000) OR left(dal,1)=2")));
      d.denik.browse_load(conc(D_cond.get,cconc(or(d.u2.get,d.u5.get,d.u6.get),conc(" AND (",D_cond2.get,")"))));
      D_prepocet }
    proc d.denik.onrowclick () { stop }
    proc d.denik.onchange() { D_prepocet }
    proc D_prepocet() {
      echo('rok=',D_info.get('year'));
      obrat.set(ask('ucet_suma',D_info.get('year'),D_cond.get,d.denik.get_query));
      d.naklad.set(obrat.get('naklad')); d.vynos.set(obrat.get('vynos'));
      d.penize.set(obrat.get('penize')); d.obrat.set(obrat.get('obrat')) }
  }
  panel D_show_load [0,0,645,520] { //type:'subpanel'
    use dl: form _cmd [0,0,,],
    var dl_info: text
    proc dl.import_denik.onclick () {
      dl_info.set(ask('ucet_load_denik',D_info.get('year')));
      dl.result.set(dl_info.get('html'));
      stop
    }
    proc dl.import_osnova.onclick () {
      dl_info.set(ask('ucet_load_osnova',D_info.get('year')));
      dl.result.set(dl_info.get('html'));
      stop
    }
    proc dl.import_akce.onclick () {
      dl_info.set(ask('ucet_load_akce',D_info.get('year')));
      dl.result.set(dl_info.get('html'));
      stop
    }
  }
  panel D_show_surv [0,0,645,520] { //type:'subpanel'
    use ds: form _cmds [0,0,,],
    var ds_info: text
    proc ds.surv1.onclick () {
      ds_info.set(ask('ucet_surv',D_info.get('year')));
      ds.result.set(ds_info.get('html'));
      stop
    }
  }
#   #                                                                                                 ROZBORY
#   panel Kalendar [,,,543] { title:'Rozbory', type:'panel'
#   }
  proc onstart () {
    set_cookie(conc(sys('system'),'_modul'),conc(sys('system'),'_',sys('module'))); stop }
# }
#                                                                                             ---   _CMD
form _cmd [,,500,200] {
  button import_denik [0,0,100,20] { title:'import deníku' }
  button import_osnova [150,0,100,20] { title:'import osnovy' }
  button import_akce [300,0,100,20] { title:'import akcí' }
  label result [0,30,700,600] { title:'...' },
}
form _cmds [,,500,200] {
  button surv1 [0,0,100,20] { title:'účty' }
  label result [0,30,700,600] { title:'...' },
}
#                                                                                             ---   _DOCS
form _denik [,,500,500] {
  check u5 [0,0,100,14] { title:'náklady', format:'t', proc onchange () { D_zmena_check } }
  field naklad [73,0,70,17] { format:'r' }
  check u6 [165,0,100,14] { title:'výnosy', format:'t', proc onchange () { D_zmena_check } }
  field vynos  [247,0,70,17] { format:'r' }
  label [336,0,40,17] { title:'výsledek' }
  field obrat  [400,0,70,17] { format:'r' }
  check u2 [490,0,100,14] { title:'peníze', format:'t', proc onchange () { D_zmena_check } }
  field penize [561,0,70,17] { format:'r' }
  browse denik [0,25,500,500] { rows:24, qry_rows:2
    show id     [,,  0,] {                 data:udenik.id_udenik },
    show datum  [,, 70,] { title:'datum',  data:udenik.Datum,           format:'s-q' },
    show zdroj  [,, 60,] { title:'zdroj',  data:udenik.Zdroj,           format:'sq' },
    show popis  [,,180,] { title:'popis',  data:udenik.Text,            format:'sq' },
    show md     [,, 50,] { title:'MD',     data:udenik.MD,              format:'rsq' },
    show dal    [,, 50,] { title:'DAL',    data:udenik.DAL,             format:'rsq' },
    show castka [,, 70,] { title:'částka', data:udenik.Castka,          format:'rsq' },
    show ref    [,, 30,] { title:'ref',    data:udenik.RefCin,          format:'rsq' },
    show akce   [,, 30,] { title:'akce',   data:udenik.Cinnost,         format:'rsq' },
    show dotace [,, 60,] { title:'dotace', data:udenik.Stredisko,       format:'sq' },
  }
}
#                                                                                             ---   _TOUCH
form _touch [,,700,50] {
  label volby [0,0,200,570] { title:''
    proc onmenuclick (s,c) {
      eq(s,'u-show','u-load','u-surv','u-akce','msds'); D_menu(s,c)
    | stop
    }
  },
  label result [200,0,700,600] { title:'' },
}
table udenik {
  number id_udenik { key:'primary' }
  date Datum
  text Zdroj
  text Text
  text MD
  text DAL
  number Castka
  text Stredisko
  text RefCin
  text Cinnost
}
*/
form f {
  label result [0,0,600,] { title:'--' }
}
